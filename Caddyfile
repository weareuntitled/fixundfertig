{$APP_DOMAIN} {
    # Security hardening (TLS handled by Caddy)
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Frame-Options "DENY"
        X-Content-Type-Options "nosniff"
        Referrer-Policy "no-referrer"
        Permissions-Policy "geolocation=(), microphone=(), camera=()"
        # CSP: start in report-only, then tighten after validating NiceGUI resources.
        Content-Security-Policy-Report-Only "default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'none'; form-action 'self'; img-src 'self' data: blob:; font-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; connect-src 'self' https://{$APP_DOMAIN} wss://{$APP_DOMAIN};"
    }

    # Request body limit:
    # - Multipart uploads: ~10MB + small overhead
    # - n8n JSON base64 ingest: 10MB file -> ~13.4MB base64 + JSON overhead
    request_body {
        max_size 20MB
    }

    reverse_proxy app:8000
}

{$N8N_DOMAIN} {
    reverse_proxy n8n:5678 {
        flush_interval -1
    }
}

# --- NEU: Dein Tracklistify ---
tracklistify.untitled-ux.de {
    reverse_proxy tracklistify:5000
}

# --- NEU: Dein UX-Portfolio ---
dein-portfolio.untitled-ux.de {
    reverse_proxy ux-portfolio:3000
}